<div class="safe-area-aware">
  <div class="global-audio-player" *ngIf="shouldShowPlayer" [class.loading]="isLoading" (click)="openFullscreenPlayer()">
    <div class="glare-effect" *ngIf="isLoading"></div>
    <img *ngIf="photoUrl" [src]="photoUrl" alt="audio" class="audio-image" />
    <div class="audio-center">
      <div class="audio-title">{{ title }}</div>
    </div>
    <div class="player-controls" (click)="$event.stopPropagation()">
      <div class="button-safe-area">
        <button 
        class="favorite-btn" 
        (click)="toggleFavorite($event)" 
        [class.favorited]="isFavorite"
        [disabled]="!storyId && !title">
        <ion-icon 
          [name]="isFavorite ? 'heart' : 'heart-outline'" 
          size="large"
          [color]="isFavorite ? 'primary' : 'medium'">
        </ion-icon>
      </button>
      </div>
      <div class="button-safe-area">
        <button class="audio-settings-btn" (click)="openAmbientSettings()">
          <ion-icon name="options-outline" size="large"></ion-icon>
        </button>
      </div>
      <div class="button-safe-area">
        <button class="audio-play-btn" 
                [class.loading]="isPlayButtonLoading"
                (click)="togglePlay()" 
                [disabled]="isPlayButtonLoading">
          <ion-icon 
            *ngIf="!isPlayButtonLoading" 
            [name]="isPlaying ? 'pause' : 'play'" 
            size="large">
          </ion-icon>
          <ion-spinner 
            *ngIf="isPlayButtonLoading" 
            name="crescent" 
            size="small">
          </ion-spinner>
        </button>
      </div>
    </div>
  </div>
</div>
